package friendgoods.vidic.com.generalframework.activity.fragment;import android.content.Context;import android.content.Intent;import android.os.Bundle;import android.support.annotation.NonNull;import android.support.annotation.Nullable;import android.text.TextUtils;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.TextView;import com.bumptech.glide.Glide;import com.bumptech.glide.load.engine.DiskCacheStrategy;import com.google.gson.Gson;import com.lzy.okgo.OkGo;import com.lzy.okgo.callback.StringCallback;import com.youth.banner.Banner;import com.youth.banner.BannerConfig;import com.youth.banner.Transformer;import com.youth.banner.loader.ImageLoader;import java.util.ArrayList;import butterknife.BindView;import butterknife.ButterKnife;import friendgoods.vidic.com.generalframework.Bean.ShowMinejifenBean;import friendgoods.vidic.com.generalframework.Bean.ShowyouhuiquanBean;import friendgoods.vidic.com.generalframework.Bean.ShowyuejifenBean;import friendgoods.vidic.com.generalframework.Bean.UserInfoBean;import friendgoods.vidic.com.generalframework.R;import friendgoods.vidic.com.generalframework.activity.AfterAdminActivity;import friendgoods.vidic.com.generalframework.activity.AppraisalActivity;import friendgoods.vidic.com.generalframework.activity.BalanceActivity;import friendgoods.vidic.com.generalframework.activity.ConsumptionActivity;import friendgoods.vidic.com.generalframework.activity.CouponActivity;import friendgoods.vidic.com.generalframework.activity.LoginActivity;import friendgoods.vidic.com.generalframework.activity.OrderActivity;import friendgoods.vidic.com.generalframework.activity.SettingActivity;import friendgoods.vidic.com.generalframework.activity.TellActivity;import friendgoods.vidic.com.generalframework.activity.VisaActivity;import friendgoods.vidic.com.generalframework.activity.wode.GaojiRenzhengActivity;import friendgoods.vidic.com.generalframework.activity.wode.GuanliAdddressActivity;import friendgoods.vidic.com.generalframework.activity.wode.PhoneActivity;import friendgoods.vidic.com.generalframework.activity.wode.ShimingOkActivity;import friendgoods.vidic.com.generalframework.activity.wode.WeChatActivity;import friendgoods.vidic.com.generalframework.faxian.JifenShoppingmallActivity;import friendgoods.vidic.com.generalframework.faxian.MyJifenActivity;import friendgoods.vidic.com.generalframework.faxian.YaoqinghaoyouActivity;import friendgoods.vidic.com.generalframework.touzi.EmailActivity;import friendgoods.vidic.com.generalframework.touzi.TouziMoreActivity;import friendgoods.vidic.com.generalframework.touzi.XitongMessagesActivity;import friendgoods.vidic.com.generalframework.util.Api;import friendgoods.vidic.com.generalframework.util.CircleImageView;import friendgoods.vidic.com.generalframework.util.IntentUtils;import friendgoods.vidic.com.generalframework.util.SharedPreferencesHelper;import friendgoods.vidic.com.generalframework.util.ToastUtils;import okhttp3.Call;import okhttp3.Response;import static friendgoods.vidic.com.generalframework.MainActivity.Userid;/** * 我的页面 */public class FragmentMy extends BaseFragment {    private View view;    private ImageView mineSetting;    private LinearLayout mineVisa;    private LinearLayout mineAppraisal;    private LinearLayout mineBalance;    private LinearLayout mineCoupon;    private LinearLayout mineOrder;    private LinearLayout afterAdmin;    private LinearLayout mineConsumption;    private LinearLayout mineTell;    private Context context;//    private ImageView mine_img;    @Override    public void onAttach(Context context) {        super.onAttach(context);        this.context = context;    }    @Override    public void onCreate(@Nullable Bundle savedInstanceState) {        super.onCreate(savedInstanceState);    }    /**     * 绑定事件使用     * @param view     * @param savedInstanceState     */    @Override    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {        super.onViewCreated(view, savedInstanceState);        setBind();    }    @Nullable    @Override    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {        view = LayoutInflater.from(getActivity()).inflate(R.layout.fragment_mine, null);        ButterKnife.bind(this,view);        sharehelper = new SharedPreferencesHelper(                context, "chuanjiabao");        phone = sharehelper.getSharedPreference("userphone","").toString();        initView();        return view;    }    /**     * 我的界面第2排和第3排绑定事件     */    @BindView(R.id.my_phone)    LinearLayout lphone;    @BindView(R.id.my_wechat)    LinearLayout lwechat;    @BindView(R.id.my_email)    LinearLayout lemail;    @BindView(R.id.my_guanlidihzi)    LinearLayout lguanlidihzi;    @BindView(R.id.my_touzirenzheng)    LinearLayout ltouzirenzheng;    @BindView(R.id.my_gaojirenzheng)    LinearLayout lgaojirenzheng;    @BindView(R.id.mine_jifenshjopping)    LinearLayout l_jifenshjopping;    @BindView(R.id.mine_yaoqing)    LinearLayout l_yaoqing;    @BindView(R.id.mine_jifen)    LinearLayout l_jifen;    @BindView(R.id.mine_login)    TextView tv_login;    private ArrayList<Integer> list_path;    private ArrayList<String> list_title;    private void setBind(){        //放图片地址的集合        list_path = new ArrayList<>();        //放标题的集合        list_title = new ArrayList<>();        lphone.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(context, PhoneActivity.class);                startActivity(intent);            }        });        lwechat.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(context, WeChatActivity.class);                startActivity(intent);            }        });        lemail.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(context, EmailActivity.class);                startActivity(intent);            }        });        lguanlidihzi.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(context, GuanliAdddressActivity.class);                startActivity(intent);            }        });        ltouzirenzheng.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(context, ShimingOkActivity.class);                startActivity(intent);            }        });        lgaojirenzheng.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {//                Intent intent = new Intent(context, GaojiRenzhengActivity.class);//                startActivity(intent);                final android.support.v7.app.AlertDialog.Builder builder = new android.support.v7.app.AlertDialog.Builder(context);                LayoutInflater inflater = LayoutInflater.from(context);                final View DialogView = inflater .inflate ( R.layout.xinshouxunlian, null);//1、自定义布局                ImageView no = (ImageView) DialogView.findViewById(R.id.xinshouguanbi);//自定义控件                Banner banner = (Banner) DialogView.findViewById(R.id.banner2);//自定义控件                builder.setView(DialogView);                final android.support.v7.app.AlertDialog dialog = builder.create();                list_path.add(R.mipmap.show1);                list_path.add(R.mipmap.show2);                list_path.add(R.mipmap.show33);                list_path.add(R.mipmap.show4);                list_path.add(R.mipmap.show5);                list_path.add(R.mipmap.show6);                list_path.add(R.mipmap.show7);                //设置内置样式，共有六种可以点入方法内逐一体验使用。                banner.setBannerStyle(BannerConfig.NOT_INDICATOR);                //设置图片加载器，图片加载器在下方                banner.setImageLoader(new MyImageLoader());                //设置图片网址或地址的集合                banner.setImages(list_path);                //设置轮播的动画效果，内含多种特效，可点入方法内查找后内逐一体验                banner.setBannerAnimation(Transformer.Default);                //设置轮播图的标题集合                banner.setBannerTitles(list_title);                //设置轮播间隔时间                banner.setDelayTime(3000);                //设置是否为自动轮播，默认是“是”。                banner.isAutoPlay(false);                //设置指示器的位置，小点点，左中右。                banner.setIndicatorGravity(BannerConfig.CENTER)                        //以上内容都可写成链式布局，这是轮播图的监听。比较重要。方法在下面。                        //必须最后调用的方法，启动轮播图。                        .start();                //点击取消                no.setOnClickListener(new View.OnClickListener() {                    @Override                    public void onClick(View view) {                        dialog.dismiss();                    }                });                dialog.show();            }        });        Iv_xiaoxi.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(context, XitongMessagesActivity.class);                startActivity(intent);            }        });        l_jifenshjopping.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                //一期隐藏积分商城                Intent intent = new Intent(context, JifenShoppingmallActivity.class);                startActivity(intent);//                ToastUtils.shortToast("敬请期待！");            }        });        l_yaoqing.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(context, YaoqinghaoyouActivity.class);                startActivity(intent);            }        });        l_jifen.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(context, MyJifenActivity.class);                startActivity(intent);            }        });    }    /**     * 图片加载类     */    private class MyImageLoader extends ImageLoader {        @Override        public void displayImage(Context context, Object path, ImageView imageView) {            Glide.with(context.getApplicationContext())                    .load(path)                    .into(imageView);        }    }    private void initView() {        mineSetting = view.findViewById(R.id.mine_setting);        mineVisa = view.findViewById(R.id.mine_visa);        mineAppraisal = view.findViewById(R.id.mine_appraisal);        mineBalance = view.findViewById(R.id.mine_balance);        mineCoupon = view.findViewById(R.id.mine_coupon);        mineOrder = view.findViewById(R.id.mine_order);        afterAdmin = view.findViewById(R.id.after_admin);        mineConsumption = view.findViewById(R.id.mine_consumption);        mineTell = view.findViewById(R.id.mine_tell);        mineSetting.setOnClickListener(this);        mineVisa.setOnClickListener(this);        mineAppraisal.setOnClickListener(this);        mineBalance.setOnClickListener(this);        mineCoupon.setOnClickListener(this);        mineOrder.setOnClickListener(this);        afterAdmin.setOnClickListener(this);        mineConsumption.setOnClickListener(this);        mineTell.setOnClickListener(this);    }    @BindView(R.id.wode_xiaoxi)    ImageView Iv_xiaoxi;    @Override    public void onClick(View view) {        switch (view.getId()){            case R.id.mine_setting:                IntentUtils.startActivity(getActivity(),SettingActivity.class,false);                break;            case R.id.mine_visa:                IntentUtils.startActivity(getActivity(),VisaActivity.class,false);                break;            case R.id.mine_appraisal:                IntentUtils.startActivity(getActivity(),AppraisalActivity.class,false);                break;            case R.id.mine_balance:                IntentUtils.startActivity(getActivity(),BalanceActivity.class,false);                break;            case R.id.mine_coupon:                IntentUtils.startActivity(getActivity(),CouponActivity.class,false);                break;            case R.id.mine_order:                IntentUtils.startActivity(getActivity(),OrderActivity.class,false);                break;            case R.id.after_admin:                IntentUtils.startActivity(getActivity(),AfterAdminActivity.class,false);                break;            case R.id.mine_consumption:                IntentUtils.startActivity(getActivity(),ConsumptionActivity.class,false);                break;            case R.id.mine_tell:                IntentUtils.startActivity(getActivity(),TellActivity.class,false);                break;        }    }    /**     * 显示信息     */    //昵称、代金券数量、用户头像、用户手机号 、用户邮箱、账户余额、积分    public static String nick_name,numbers,user_head,user_phone,user_email,balance,integral,user_wechat;    //导入封装好的sharepreference    private SharedPreferencesHelper sharehelper;    @BindView(R.id.mine_account_balance)    TextView tv_balance;    @BindView(R.id.mine_jifenshow)    TextView tv_jifenshow;    @BindView(R.id.mine_coupon_show)    TextView tv_coupon_show;    private String phone;    @BindView(R.id.mine_img)    CircleImageView mine_img;    private void setShowinfo(){        //点击头像        mine_img.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                IntentUtils.startActivity(getActivity(),SettingActivity.class,false);            }        });        //获取用户信息并存储        OkGo.post(Api.myinfo)                .tag(this)                .params("uuid",sharehelper.getSharedPreference("userid","").toString())                .execute(new StringCallback() {                    @Override                    public void onSuccess(String s, Call call, Response response) {                        Gson gson = new Gson();                        UserInfoBean userInfoBean = gson.fromJson(s,UserInfoBean.class);                        if (userInfoBean.getState()==1){                            Log.e("用户信息",s);                            nick_name = userInfoBean.getData().getUser_nick_name();                            user_head = userInfoBean.getData().getUser_head_portrait();                            user_phone = userInfoBean.getData().getUser_phone();                            user_email = userInfoBean.getData().getUser_Email();                            user_wechat = userInfoBean.getData().getUser_WeChat();                            //展示头像//                            ToastUtils.centerToast("**"+user_head);                            if(userInfoBean.getData().getUser_head_portrait()!=null){//                                ToastUtils.centerToast("--"+user_head);                                String url = Api.ossurl+user_head;                                Glide.with(context).load(url).into(mine_img);                            }else {                            }                            //如果没有昵称直接显示手机号，如果有就显示昵称                            Log.e("手机号",phone+"*"+nick_name);                            if (TextUtils.isEmpty(nick_name) && !TextUtils.isEmpty(phone)){                                tv_login.setText(phone);                            }else if (!TextUtils.isEmpty(nick_name) || nick_name!=null ){                                if (nick_name.length()>8){                                    tv_login.setText(nick_name.substring(0,8)+"...");                                }else {                                    tv_login.setText(nick_name);                                }                            }else {                                tv_login.setText("尚未登录");                            }                        }else{                            ToastUtils.shortToast(userInfoBean.getMessage());                        }                    }                });        //展示用户昵称，用户的账户余额，积分，代金券        //用户登录了，点击用户昵称直接跳转到个人设置 页面        tv_login.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                if (!tv_login.getText().toString().equals("尚未登录")){                    Intent intent = new Intent(context,SettingActivity.class);                    startActivity(intent);                }else {                    Intent intent = new Intent(context,LoginActivity.class);                    startActivity(intent);                }            }        });    }    @Override    public void onResume() {        super.onResume();        Log.e("返回","111");//        setShowinfo();        if (Userid==null || Userid==""){            tv_balance.setText("0.0元");            tv_jifenshow.setText("0分");            tv_coupon_show.setText("0张");            tv_login.setText("尚未登录");            Log.e("返回","222");        }else{            Log.e("返回","333");            setShowinfo();        }        getyue();        getyouhuiquan();    }    private void getyue(){        //获取用户信息并存储        Log.e("账户显示",Userid);        OkGo.post(Api.showyue)                .tag(this)                .params("uuid",Userid)                .execute(new StringCallback() {                    @Override                    public void onSuccess(String s, Call call, Response response) {                        Log.e("账户显示",s);                        Gson gson = new Gson();                        ShowyuejifenBean showyuejifenBean = gson.fromJson(s,ShowyuejifenBean.class);                        if (showyuejifenBean.getState()==1){                            if (showyuejifenBean.getData()!=null){                                //显示余额，积分                                if (TextUtils.isEmpty(showyuejifenBean.getData().getAccount_balance())){                                    tv_balance.setText("0.0元");                                }else {                                    tv_balance.setText(Integer.parseInt(showyuejifenBean.getData().getAccount_balance())+"元");                                }                            }                        }                    }                });        OkGo.post(Api.myjifen)                .tag(this)                .params("uuid",Userid)                .execute(new StringCallback() {                    @Override                    public void onSuccess(String s, Call call, Response response) {                        Gson gson = new Gson();                        ShowMinejifenBean showMinejifenBean = gson.fromJson(s,ShowMinejifenBean.class);                        if (showMinejifenBean.getState()==1){                            if (showMinejifenBean.getData()!=null){                                tv_jifenshow.setText(showMinejifenBean.getData().getIntegral()+"");                            }                        }else {                            ToastUtils.shortToast(showMinejifenBean.getMessage());                        }                    }                });    }    private void getyouhuiquan(){        OkGo.post(Api.showyouhui)                .tag(this)                .params("uuid",Userid)                .params("page",1)                .params("pageSize",1000)                .execute(new StringCallback() {                    @Override                    public void onSuccess(String s, Call call, Response response) {                        Log.e("优惠券",s);                        Gson gson = new Gson();                        ShowyouhuiquanBean showyouhuiquanBean = gson.fromJson(s,ShowyouhuiquanBean.class);                        if (showyouhuiquanBean.getState()==1){                            if (showyouhuiquanBean.getData()!=null){                                tv_coupon_show.setText(showyouhuiquanBean.getData().getPageInfo().getTotal()+"张");                            }                        }                    }                });    }}